import json
import asyncio  # GPT í˜¸ì¶œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬
import requests
import openai
from pathlib import Path
from django.conf import settings
from pydantic import BaseModel, conlist, Field  # ë°ì´í„° ìœ íš¨ì„±ê²€ì‚¬ + ìë™ íƒ€ì… ë³€í™˜



openai_api_key=settings.OPENAI_API_KEY

# ë¶„ì•¼ë³„ ì ìˆ˜ ê³„ì‚° ===============================================================================================================
def generate_fread_analysis_score(original_text):
    class FreadAnalysisCriteria(BaseModel):
        logic: int = Field(..., gt=0, le=100)
        appeal: int = Field(..., gt=0, le=100)
        focus: int = Field(..., gt=0, le=100)
        simplicity: int = Field(..., gt=0, le=100)
        popularity: int = Field(..., gt=0, le=100)

        @property
        def total(self) -> float:
            return round(   # totalì€ ì†Œìˆ˜ì  ì²«ì§¸ìë¦¬ê¹Œì§€ ê³„ì‚°.
                (self.logic + self.appeal + self.focus + self.simplicity + self.popularity) / 5, 1
            )
        
    prompt = original_text

    try:
        client = openai.OpenAI(api_key=openai_api_key)
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {
                    "role": "system",
                    "content": """
                        ë‹¹ì‹ ì€ í…ìŠ¤íŠ¸ë¥¼ ì •ëŸ‰ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ë‹¤ì„¯ ê°€ì§€ í•­ëª©ì— ëŒ€í•´ ì ìˆ˜ë¥¼ ë§¤ê²¨ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ëŠ” AI í‰ê°€ìì…ë‹ˆë‹¤.

                        ê° í•­ëª©ì€ ë‹¤ìŒê³¼ ê°™ìœ¼ë©°, ê°ê° 1~100ì  ì‚¬ì´ì˜ **ì •ìˆ˜í˜• ìˆ«ì**ë¡œë§Œ ì ìˆ˜ë¥¼ ë¶€ì—¬í•´ì•¼ í•©ë‹ˆë‹¤.  
                        ì ˆëŒ€ë¡œ ì†Œìˆ˜ì ì´ë‚˜ ë²”ìœ„, í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ **ì •ìˆ˜ë§Œ ì‘ë‹µí•˜ì„¸ìš”.**

                        ---

                        ğŸ“Š í‰ê°€ í•­ëª© ë° ê¸°ì¤€ (ê° í•­ëª©ë‹¹ 1~100ì , ì •ìˆ˜):

                        1. logic (ì„¤ë“ë ¥, Persuasiveness)  
                        - ê¸€ì´ ë…ìì—ê²Œ ì–¼ë§ˆë‚˜ ë…¼ë¦¬ì ìœ¼ë¡œ ë‚©ë“ë  ìˆ˜ ìˆëŠ”ê°€ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.  
                        - ì£¼ì¥ê³¼ ê·¼ê±°ê°€ ëª…í™•í•˜ê²Œ ì—°ê²°ë˜ì–´ ìˆëŠ”ê°€?  
                        - ê¸€ ì „ì²´ì˜ ì „ê°œê°€ ë…¼ë¦¬ì  ìˆœì„œë¥¼ ë”°ë¥´ê³  ìˆëŠ”ê°€?  
                        - ë¶ˆí•„ìš”í•œ ê°ì •ì  í˜¸ì†Œ ì—†ì´ ë…¼ë¦¬ ìì²´ë¡œ ì„¤ë“ë ¥ì„ ê°–ì¶”ì—ˆëŠ”ê°€?  
                        - ë°˜ë¡  ê°€ëŠ¥ì„±ì„ ì¸ì§€í•˜ê³  ì´ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ë‹¤ë¤˜ëŠ”ê°€?

                        2. appeal (ì „ë‹¬ë ¥, Clarity & Relatability)  
                        - í…ìŠ¤íŠ¸ê°€ ë…ìì—ê²Œ ì˜ë¯¸ë¥¼ ë¶„ëª…í•˜ê²Œ ì „ë‹¬í•˜ê³ , ê°ì •ì  ê³µê°ì„ ì´ëŒì–´ë‚´ëŠ” ì •ë„ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.  
                        - í•µì‹¬ ë©”ì‹œì§€ê°€ ëª…í™•í•˜ê²Œ í‘œí˜„ë˜ì–´ ìˆëŠ”ê°€?  
                        - ë¹„ìœ , ì˜ˆì‹œ, êµ¬ì²´ì  ì–¸ì–´ë¥¼ í†µí•´ ì˜ë¯¸ê°€ ì‰¬ìš´ê°€?  
                        - ë…ìì˜ ì…ì¥ì—ì„œ ê°ì • ì´ì…ì´ ê°€ëŠ¥í•œê°€?  
                        - ë³µì¡í•œ ë‚´ìš©ì„ ì‰½ê²Œ í’€ì–´ ì“°ë ¤ëŠ” ë…¸ë ¥ì´ ìˆëŠ”ê°€?

                        3. focus (ëª°ì…ë„, Immersion)  
                        - ê¸€ì˜ íë¦„ì´ ìì—°ìŠ¤ëŸ½ê³  ë…ìê°€ ì§‘ì¤‘ë ¥ì„ ìœ ì§€í•˜ë©° ì½ì„ ìˆ˜ ìˆëŠ”ì§€ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.  
                        - í¥ë¯¸ë¡œìš´ ì „ê°œ, ê¸´ì¥ê°, ë˜ëŠ” ê¶ê¸ˆì¦ ìœ ë°œì´ ìˆëŠ”ê°€?  
                        - ì¤‘ê°„ì— ì‚°ë§Œí•˜ê±°ë‚˜ ëŠ˜ì–´ì§€ëŠ” ë¶€ë¶„ ì—†ì´ ì§‘ì¤‘ì´ ìœ ì§€ë˜ëŠ”ê°€?  
                        - ë¬˜ì‚¬ë‚˜ ì´ì•¼ê¸°ì˜ ë¦¬ë“¬ì´ ë§¤ë„ëŸ¬ìš´ê°€?  
                        - ì„œì‚¬ì  í¡ì¸ë ¥ ë˜ëŠ” ë…¼ë¦¬ì  ì¼ê´€ì„±ì´ ëª°ì…ì„ ìœ ë„í•˜ëŠ”ê°€?

                        4. simplicity (ë¬¸ì¥ ê°„ê²°ì„±, Conciseness & Structure)  
                        - ë¬¸ì¥ì´ êµ°ë”ë”ê¸° ì—†ì´ í•µì‹¬ì„ ì „ë‹¬í•˜ê³ , êµ¬ì¡°ì ìœ¼ë¡œ ì •ëˆë˜ì–´ ìˆëŠ”ì§€ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.  
                        - ë¶ˆí•„ìš”í•œ ìˆ˜ì‹ì´ë‚˜ ì¤‘ë³µ í‘œí˜„ì´ ì œê±°ë˜ì–´ ìˆëŠ”ê°€?  
                        - ë¬¸ì¥ì´ ë„ˆë¬´ ê¸¸ê±°ë‚˜ ë³µì¡í•˜ì§€ ì•Šê³ , ì ì ˆí•˜ê²Œ ëŠì–´ì§€ëŠ”ê°€?  
                        - ë‹¨ë½ êµ¬ì„±ì´ ì ì ˆí•˜ë©°, ê° ë¬¸ì¥ì´ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ”ê°€?  
                        - ì „ì²´ì ìœ¼ë¡œ ì½ê¸°ì— ë¶€ë‹´ ì—†ì´ ê¹”ë”í•œ íë¦„ì„ ê°€ì§€ëŠ”ê°€?

                        5. popularity (ëŒ€ì¤‘ì„±, Mass Appeal)  
                        - í…ìŠ¤íŠ¸ê°€ ë‹¤ì–‘í•œ ì—°ë ¹ê³¼ ë°°ê²½ì˜ ë…ìì—ê²Œ ê³µê°ê³¼ ì´í•´ë¥¼ ì¤„ ìˆ˜ ìˆëŠ”ì§€ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.  
                        - íŠ¹ì • ê³„ì¸µë§Œ ì´í•´í•  ìˆ˜ ìˆëŠ” ì „ë¬¸ ìš©ì–´ë‚˜ ë¬¸í™”ì  ë§¥ë½ì´ ì—†ëŠ”ê°€?  
                        - ì£¼ì œì™€ í‘œí˜„ì´ ë³´í¸ì ì´ë©°, ëŒ€ì¤‘ì  ì·¨í–¥ì„ ë°˜ì˜í•˜ëŠ”ê°€?  
                        - ê¸€ì´ ë„ˆë¬´ íŠ¹ìˆ˜í•˜ê±°ë‚˜ ì‹¤í—˜ì ì´ì§€ ì•Šê³ , ë„“ì€ ë…ìì¸µì´ ì½ê¸°ì— ë¶€ë‹´ì´ ì—†ëŠ”ê°€?  
                        - ì†Œí†µí•˜ë ¤ëŠ” íƒœë„ê°€ ë“œëŸ¬ë‚˜ëŠ”ê°€?


                        ğŸ“¥ ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”:

                        {
                        "logic": 85,
                        "appeal": 90,
                        "focus": 88,
                        "simplicity": 92,
                        "popularity": 86
                        }

                        - ëª¨ë“  ê°’ì€ 1~100 ì‚¬ì´ì˜ **ì •ìˆ˜**ì—¬ì•¼ í•©ë‹ˆë‹¤.
                        - ì ˆëŒ€ë¡œ ì„¤ëª…, ì†Œìˆ˜ì , ê¸°íƒ€ í…ìŠ¤íŠ¸ë¥¼ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
                        - JSON ì™¸ì—ëŠ” ì•„ë¬´ê²ƒë„ ì¶œë ¥í•˜ì§€ ë§ˆì„¸ìš”.
                        - í•œ í•­ëª©ì´ë¼ë„ ë¹ˆ ê°’ì´ ë‚˜ì™€ì„œëŠ” ì•ˆë©ë‹ˆë‹¤. ë°˜ë“œì‹œ ê°’ì„ ê³„ì‚°í•´ë‚´ì•¼ í•©ë‹ˆë‹¤.

                        ---

                        ğŸ›‘ ì¤‘ìš” ì œì•½ ì¡°ê±´:

                        - ìœ„ ë‹¤ì„¯ í•­ëª© **ì „ë¶€ ë°˜ë“œì‹œ í¬í•¨**ë˜ì–´ì•¼ í•˜ë©°, **í•˜ë‚˜ë¼ë„ ëˆ„ë½ë˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**
                        - **null, ë¹ˆ ë¬¸ìì—´, ìƒëµ, ìƒëµëœ key** ëŠ” ì ˆëŒ€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        - ëª¨ë“  í•­ëª©ì˜ ê°’ì€ **ë°˜ë“œì‹œ ìœ íš¨í•œ 1~100 ì‚¬ì´ì˜ ì •ìˆ˜**ì—¬ì•¼ í•©ë‹ˆë‹¤.
                        - **ì ˆëŒ€ë¡œ JSON ì´ì™¸ì˜ í…ìŠ¤íŠ¸(ì„¤ëª…, í•´ì„, ì„œë¬¸ ë“±)ë¥¼ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.**
                        - ì‹œìŠ¤í…œì€ ì‘ë‹µì„ íŒŒì‹±í•˜ì—¬ ìë™ ì²˜ë¦¬í•˜ë¯€ë¡œ, ìœ„ ì¡°ê±´ì„ ì§€í‚¤ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
                    """,
                },
                {"role": "user", "content": prompt},
            ],
            # response_format=FreadAnalysisCriteria,
            max_tokens=2040,
            temperature=0.5,
        )

        json_response = response.choices[0].message.content.strip()
        # print(json_response)

        data = json.loads(json_response)    # JSON íŒŒì‹± (JSON -> dict)
        validated = FreadAnalysisCriteria(**data)  # Pydantic ëª¨ë¸ë¡œ ìœ íš¨ì„± ê²€ì‚¬ ë° êµ¬ì¡°í™”
        return validated
    
    except Exception as e:
        print("GPT ë¶„ì„ ì ìˆ˜ ìƒì„± ì—ëŸ¬:", e)
        return "ì ì‹œ ë¶„ì„ì´ ì›í™œí•˜ì§€ ì•Šì•˜ì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
    


# ì˜ˆìƒ ëŒ“ê¸€ ìƒì„± ===============================================================================================================
''' ì´ 50ê°œ ëŒ“ê¸€ ì˜ˆìƒ í˜•íƒœ
{
    "10ëŒ€": {
        "male": [
            {"content": "ëŒ“ê¸€1"},
            {"content": "ëŒ“ê¸€2"},
            ...
        ],
        "female": [
            {"content": "ëŒ“ê¸€1"},
            {"content": "ëŒ“ê¸€2"},
            ...
        ]
    },
    "20ëŒ€": {
        "male": [...],
        "female": [...]
    },
    ...
}'''

# ìµœì¢… ëŒ“ê¸€ë“¤ 50ê°œ + ëŒ€í‘œ ëŒ“ê¸€ 5ê°œ ë¦¬í„´
def generate_fread_ai_comments(original_text):
    # ìµœì¢… json ë°ì´í„° í˜•íƒœ
    grouped_ai_comments = {
        "10ëŒ€": {"male": [], "female": []},
        "20ëŒ€": {"male": [], "female": []},
        "30ëŒ€": {"male": [], "female": []},
        "40ëŒ€": {"male": [], "female": []},
        "50ëŒ€": {"male": [], "female": []},
    }

    only_contents = []  # ëŒ“ê¸€ ë‚´ìš©ë§Œ ìˆëŠ” ë¦¬ìŠ¤íŠ¸ (ëŒ€í‘œ ëŒ“ê¸€ ìƒì„±ìš©)

    # ì—°ë ¹/ì„±ë³„ ë³„ GPT í˜¸ì¶œí•˜ì—¬ ëŒ“ê¸€ ìƒì„± (5ê°œì”©)
    for age in [10, 20, 30, 40, 50]:
        for gender in ["male", "female"]:
            contents = create_ai_comment_content(original_text, age, gender)

            # ì—ëŸ¬ë©”ì‹œì§€(str)ê°€ ë¦¬í„´ëë‹¤ë©´
            if isinstance(contents, str):
                return contents  # ë¶„ì„ ì „ì²´ ì¤‘ë‹¨í•˜ê³  ì—ëŸ¬ë©”ì‹œì§€ ë°˜í™˜

            for content in contents:
                grouped_ai_comments[f"{age}ëŒ€"][gender].append({"content": content})   # ìµœì¢… json í˜•íƒœë¡œ ë¬¶ìœ¼ë©´ì„œ ì €ì¥
                only_contents.append(content)   # ëŒ€í‘œ ëŒ“ê¸€ ìƒì„±ì„ ìœ„í•´ ëŒ“ê¸€ ë‚´ìš©ë§Œ ë”°ë¡œ ë¹¼ì„œ ëª¨ìœ¼ê¸°
                    
    # ëŒ€í‘œ ëŒ“ê¸€ ìƒì„±
    final_summary_comments = generate_final_summary_comments(only_contents)

    # ì—ëŸ¬ë©”ì‹œì§€(str)ê°€ ë¦¬í„´ëë‹¤ë©´
    if isinstance(final_summary_comments, str):
        return final_summary_comments  # ë¶„ì„ ì „ì²´ ì¤‘ë‹¨í•˜ê³  ì—ëŸ¬ë©”ì‹œì§€ ë°˜í™˜
    
    grouped_ai_comments["ëŒ€í‘œ ëŒ“ê¸€"] = final_summary_comments   # ìµœì¢…ì ìœ¼ë¡œ grouped_ai_commentsì— ëŒ€í‘œ ëŒ“ê¸€ë„ ì¶”ê°€

    return grouped_ai_comments  # ìµœì¢… ë°ì´í„° dictë¡œ ë°˜í™˜




# ëŒ“ê¸€ ë‚´ìš© ìƒì„± (gpt í˜¸ì¶œ)
def create_ai_comment_content(original_text, age, gender):
    class CommentResponseModel(BaseModel):
        comments: conlist(str, min_items=5, max_items=5)    # type: ignore # ë¬¸ìì—´(ëŒ“ê¸€) 5ê°œë¡œ ì´ë£¨ì–´ì§„ ë¦¬ìŠ¤íŠ¸ì—¬ì•¼ í•¨

    prompt = original_text

    try:
        client = openai.OpenAI(api_key=openai_api_key)
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {
                    "role": "system",
                    "content": f"""
                        ë‹¹ì‹ ì€ {age}ëŒ€ {gender} ë…ì 5ëª…ì´ ì†Œì„¤ í•œ í¸ì„ ì½ì€ í›„ ë‚¨ê¸¸ ì‹¤ì œ ëŒ“ê¸€ì„ ìƒì„±í•˜ì—¬ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” AIì…ë‹ˆë‹¤.

                        - ê° ëŒ“ê¸€ì€ í•œ ì¤„ì´ë©°, ì´ëª¨í‹°ì½˜ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
                        - ê° ëŒ“ê¸€ì€ {age}ëŒ€ {gender} ë…ìì˜ ë§íˆ¬, ê°ì •, ê´€ì‹¬ì‚¬ë¥¼ ê³ ë ¤í•˜ì—¬ ì‘ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
                        - í˜„ì‹¤ì ì¸ í•œêµ­ì¸ì´ ì‘ì„±í•  ë§Œí•œ ì–´íˆ¬ì™€, ë‚´ìš©ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
                        - ëŒ“ê¸€ì€ ë¬¸ì¥ í•˜ë‚˜ë¡œ ëë‚´ì•¼ í•˜ë©°, ë„ˆë¬´ ì§§ì§€ë„ ê¸¸ì§€ë„ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.

                        ğŸ“¥ ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”:

                        {{
                            "comments": [
                                "ì•„ë‹ˆ ì§„ì§œ ì›ƒê¸°ê¸´ í•œë° ì£¼ì¸ê³µ ì¢€ ë‹µë‹µí•¨ğŸ¤”",
                                "ë­”ê°€ ì‘ê°€ë‹˜ì´ í•˜ì‹  ë‚¨ì£¼ ë¬˜ì‚¬ ë³´ë©´ ì—„ì²­ ì˜ìƒê²¼ì„ê±°ê°™ì§€ ì•ŠìŒ??ğŸ˜",
                                ...
                            ]
                        }}

                        ğŸ›‘ **ì¤‘ìš” ì œì•½ ì¡°ê±´**:

                        - **ëŒ“ê¸€ì€ ë°˜ë“œì‹œ 5ê°œì—¬ì•¼ í•˜ë©°**, 4ê°œ ë˜ëŠ” 6ê°œëŠ” ì ˆëŒ€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        - í˜„ì‹¤ì ì¸ í•œêµ­ì¸ì´ ì‘ì„±í•  ë§Œí•œ ì–´íˆ¬ì™€, ë‚´ìš©ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
                        - **null, ë¹ˆ ë¬¸ìì—´, ìƒëµëœ key**ëŠ” ì ˆëŒ€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        - ì‹œìŠ¤í…œì€ ì‘ë‹µì„ íŒŒì‹±í•˜ì—¬ ìë™ ì²˜ë¦¬í•˜ë¯€ë¡œ, ìœ„ ì¡°ê±´ì„ ì–´ê¸°ë©´ ì„œë¹„ìŠ¤ê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
                    """
                },
                {"role": "user", "content": prompt},
            ],
            max_tokens=2040,
            temperature=0.5,
        )

        json_response = response.choices[0].message.content.strip()
        # print(json_response)

        data = json.loads(json_response)    # JSON íŒŒì‹± (JSON -> dict)
        validated = CommentResponseModel(comments=data) # Pydantic ëª¨ë¸ë¡œ ìœ íš¨ì„± ê²€ì‚¬ ë° êµ¬ì¡°í™”
        return validated.comments   # list ë°˜í™˜
    
    except Exception as e:
        print(f"GPT AIëŒ“ê¸€ ë‚´ìš© ìƒì„± ì—ëŸ¬: {age}, {gender}", e)
        return "ì ì‹œ ë¶„ì„ì´ ì›í™œí•˜ì§€ ì•Šì•˜ì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
 


    
# ëŒ€í‘œ ìš”ì•½ ëŒ“ê¸€ 5ê°œ ìƒì„± (gpt í˜¸ì¶œ)
def generate_final_summary_comments(contents):
    class FinalCommentResponseModel(BaseModel):
        comments: conlist(str, min_items=5, max_items=5)    # type: ignore # ë¬¸ìì—´(ëŒ“ê¸€) 5ê°œë¡œ ì´ë£¨ì–´ì§„ ë¦¬ìŠ¤íŠ¸ì—¬ì•¼ í•¨

    prompt = contents

    try:
        client = openai.OpenAI(api_key=openai_api_key)
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {
                    "role": "system",
                    "content": f"""
                        ë‹¹ì‹ ì€ ë…ì 50ëª…ì˜ ëŒ“ê¸€ì„ ì½ê³ , í•µì‹¬ ë°˜ì‘ì„ 5ê°œì˜ ëŒ€í‘œ ëŒ“ê¸€ë¡œ ìš”ì•½í•˜ì—¬ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” AIì…ë‹ˆë‹¤.

                        - ëŒ“ê¸€ì„ ì°½ì¡°í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ê¸°ì¡´ ëŒ“ê¸€ë“¤ì„ ë¶„ì„í•˜ì—¬ ìš”ì•½ì„ í•´ì•¼ í•©ë‹ˆë‹¤.
                        - ê¸°ì¡´ì˜ ëŒ“ê¸€ê³¼ ë‚´ìš©ì´ ì™„ì „íˆ ì¼ì¹˜í•´ì„œëŠ” ì•ˆë©ë‹ˆë‹¤. 
                        - í˜„ì‹¤ì ì¸ í•œêµ­ì¸ì´ ì‘ì„±í•  ë§Œí•œ ì–´íˆ¬ì™€, ë‚´ìš©ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
                        - ê° ëŒ“ê¸€ì€ í•œ ì¤„ì´ë©°, ì´ëª¨í‹°ì½˜ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
                        - ëŒ“ê¸€ì€ ë¬¸ì¥ í•˜ë‚˜ë¡œ ëë‚´ì•¼ í•˜ë©°, ë„ˆë¬´ ì§§ì§€ë„ ê¸¸ì§€ë„ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.

                        ğŸ“¥ ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”:

                        {{
                            "comments": [
                                "ì•„ë‹ˆ ì§„ì§œ ì›ƒê¸°ê¸´ í•œë° ì£¼ì¸ê³µ ì¢€ ë‹µë‹µí•¨ğŸ¤”",
                                "ë­”ê°€ ì‘ê°€ë‹˜ì´ í•˜ì‹  ë‚¨ì£¼ ë¬˜ì‚¬ ë³´ë©´ ì—„ì²­ ì˜ìƒê²¼ì„ê±°ê°™ì§€ ì•ŠìŒ??ğŸ˜",
                                ...
                            ]
                        }}

                        ğŸ›‘ **ì¤‘ìš” ì œì•½ ì¡°ê±´**:

                        - **ëŒ“ê¸€ì€ ë°˜ë“œì‹œ 5ê°œì—¬ì•¼ í•˜ë©°**, 4ê°œ ë˜ëŠ” 6ê°œëŠ” ì ˆëŒ€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        - í˜„ì‹¤ì ì¸ í•œêµ­ì¸ì´ ì‘ì„±í•  ë§Œí•œ ì–´íˆ¬ì™€, ë‚´ìš©ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
                        - **null, ë¹ˆ ë¬¸ìì—´, ìƒëµëœ key**ëŠ” ì ˆëŒ€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        - ì‹œìŠ¤í…œì€ ì‘ë‹µì„ íŒŒì‹±í•˜ì—¬ ìë™ ì²˜ë¦¬í•˜ë¯€ë¡œ, ìœ„ ì¡°ê±´ì„ ì–´ê¸°ë©´ ì„œë¹„ìŠ¤ê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
                    """
                },
                {"role": "user", "content": prompt},
            ],
            max_tokens=2040,
            temperature=0.5,
        )

        json_response = response.choices[0].message.content.strip()
        # print(json_response)

        data = json.loads(json_response)    # JSON íŒŒì‹± (JSON -> dict)
        validated = FinalCommentResponseModel(comments=data) # Pydantic ëª¨ë¸ë¡œ ìœ íš¨ì„± ê²€ì‚¬ ë° êµ¬ì¡°í™”
        return validated.comments   # list ë°˜í™˜
    
    except Exception as e:
        print("GPT ëŒ€í‘œ ëŒ“ê¸€ ìƒì„± ì—ëŸ¬:", e)
        return "ì ì‹œ ë¶„ì„ì´ ì›í™œí•˜ì§€ ì•Šì•˜ì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."




# ì†”ë£¨ì…˜ ìƒì„± ===============================================================================================================
def generate_fread_solutions(original_text):
    class SolutionResponseModel(BaseModel):
        solutions: conlist(str, min_items=3, max_items=3)    # type: ignore # ë¬¸ìì—´(ëŒ“ê¸€) 5ê°œë¡œ ì´ë£¨ì–´ì§„ ë¦¬ìŠ¤íŠ¸ì—¬ì•¼ í•¨

    prompt = original_text

    try:
        client = openai.OpenAI(api_key=openai_api_key)
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {
                    "role": "system",
                    "content": f"""
                        ë‹¹ì‹ ì€ ê²½í—˜ ë§ì€ ì†Œì„¤ í¸ì§‘ìì´ì ê¸€ì“°ê¸° ì½”ì¹˜ì…ë‹ˆë‹¤. 

                        ë‹¹ì‹ ì˜ ì—­í• ì€ ì†Œì„¤ í•œ í¸ì„ ì½ê³ , í•´ë‹¹ ì†Œì„¤ì˜ ì™„ì„±ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆëŠ” ì†”ë£¨ì…˜ì„ ì œì‹œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. 

                        ì†”ë£¨ì…˜ì€ ì•„ë˜ ê¸°ì¤€ì„ ì •í™•íˆ ë”°ë¦…ë‹ˆë‹¤:
                        - ì´ 3ê°œì˜ ì†”ë£¨ì…˜ì„ ì œì‹œí•©ë‹ˆë‹¤.
                        - ê° ì†”ë£¨ì…˜ì€ 150ì ì´ë‚´ë¡œ ê°„ê²°í•˜ê²Œ ì‘ì„±í•©ë‹ˆë‹¤.
                        - ê° ì†”ë£¨ì…˜ì€ ëª…í™•í•˜ê³  ì‹¤ìš©ì ì´ì–´ì•¼ í•˜ë©°, êµ¬ì²´ì ì¸ ì˜ˆì‹œë¥¼ í¬í•¨í•©ë‹ˆë‹¤. 
                        - ì†”ë£¨ì…˜ì€ ë…ìê°€ ì†Œì„¤ì„ ë” ì˜ ì´í•´í•˜ê³  ëª°ì…í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ë°©í–¥ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤. 
                        - ì•„ë˜ëŠ” ì°¸ê³ í•  ìˆ˜ ìˆëŠ” ì˜ˆì‹œì¼ ë¿, ë°˜ë“œì‹œ ì´ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.

                        ì˜ˆ:
                        - "ë§ì¶¤ë²•ì„ ë” ì‹ ê²½ ì¨ ì£¼ì„¸ìš”. ì˜ˆ: 'ì•„ë¦„ë‹¤ì›Œìš”' â†’ 'ì•„ë¦„ë‹¤ì›Œìš”.'"
                        - "ìºë¦­í„°ì˜ ê°ì •ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ í‘œí˜„í•´ ë³´ì„¸ìš”. ì˜ˆ: 'ìŠ¬íë‹¤' â†’ 'ëˆˆë¬¼ì´ ë§ºí˜”ë‹¤.'"
                        - "ë°°ê²½ ë¬˜ì‚¬ë¥¼ ë” ìƒë™ê° ìˆê²Œ ì¶”ê°€í•´ ë³´ì„¸ìš”. ì˜ˆ: 'ë°¤í•˜ëŠ˜ì´ ì–´ë‘ì› ë‹¤' â†’ 'ë³„ë¹›ì´ í¬ë¯¸í•˜ê²Œ ë°˜ì§ì˜€ë‹¤.'"

                        í”„ë¡¬í¬íŠ¸ë¡œ ì „ë‹¬ë˜ëŠ” ì†Œì„¤ í•œ í¸ì„ ì½ê³ , ì´ ê¸°ì¤€ì— ë§ëŠ” ì†”ë£¨ì…˜ì„ ì œì‹œí•˜ì„¸ìš”.
                        ë‹¹ì‹ ì€ ì†Œì„¤ í•œ í¸ì„ ì½ê³  ê·¸ í•œ í¸ì˜ ì†Œì„¤ì— ëŒ€í•œ ì†”ë£¨ì…˜ì„ ì œê³µí•˜ëŠ” 


                        ğŸ“¥ ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”:

                        {{
                            solutions:[
                                "ë§ì¶¤ë²•ì„ ë” ì‹ ê²½ ì¨ ì£¼ì„¸ìš”. ì˜ˆ: 'ê·¸ë…€ëŠ” ë§›ìˆëŠ”ê²ƒì„ ì¢‹ì•„í•˜ê²Œ ë¼ì—ˆë‹¤.' â†’ 'ê·¸ë…€ëŠ” ë§›ìˆëŠ” ê²ƒì„ ì¢‹ì•„í•˜ê²Œ ë˜ì—ˆë‹¤.'",
                                "ìºë¦­í„°ì˜ ê°ì •ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ í‘œí˜„í•´ ë³´ì„¸ìš”. ì˜ˆ: 'ìŠ¬íë‹¤' â†’ 'ëˆˆë¬¼ì´ ë§ºí˜”ë‹¤.'",
                                "ë°°ê²½ ë¬˜ì‚¬ë¥¼ ë” ìƒë™ê° ìˆê²Œ ì¶”ê°€í•´ ë³´ì„¸ìš”. ì˜ˆ: 'ë°¤í•˜ëŠ˜ì´ ì–´ë‘ì› ë‹¤' â†’ 'ë³„ë¹›ì´ í¬ë¯¸í•˜ê²Œ ë°˜ì§ì˜€ë‹¤.'"
                            ]
                        }}

                        ğŸ›‘ **ì¤‘ìš” ì œì•½ ì¡°ê±´**:

                        - **ì†”ë£¨ì…˜ì€ ë°˜ë“œì‹œ 3ê°œì—¬ì•¼ í•˜ë©°**, 2ê°œ ë˜ëŠ” 4ê°œëŠ” ì ˆëŒ€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        - **null, ë¹ˆ ë¬¸ìì—´, ìƒëµëœ key**ëŠ” ì ˆëŒ€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        - ì‹œìŠ¤í…œì€ ì‘ë‹µì„ íŒŒì‹±í•˜ì—¬ ìë™ ì²˜ë¦¬í•˜ë¯€ë¡œ, ìœ„ ì¡°ê±´ì„ ì–´ê¸°ë©´ ì„œë¹„ìŠ¤ê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
                    """
                },
                {"role": "user", "content": prompt},
            ],
            max_tokens=2040,
            temperature=0.5,
        )

        json_response = response.choices[0].message.content.strip()
        # print(json_response)

        data = json.loads(json_response)    # JSON íŒŒì‹± (JSON -> dict)
        validated = SolutionResponseModel(solutions=data) # Pydantic ëª¨ë¸ë¡œ ìœ íš¨ì„± ê²€ì‚¬ ë° êµ¬ì¡°í™”
        return validated.solutions   # list ë°˜í™˜
    
    except Exception as e:
        print("GPT ì†”ë£¨ì…˜ ìƒì„± ì—ëŸ¬:", e)
        return "ì ì‹œ ë¶„ì„ì´ ì›í™œí•˜ì§€ ì•Šì•˜ì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."